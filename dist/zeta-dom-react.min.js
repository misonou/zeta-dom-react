!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("zeta-dom")):"function"==typeof define&&define.amd?define("zeta-dom-react",["react","zeta-dom"],t):"object"==typeof exports?exports["zeta-dom-react"]=t(require("react"),require("zeta-dom")):e["zeta-dom-react"]=t(e.React,e.zeta)}(self,(function(e,t){return(()=>{"use strict";var r={359:t=>{t.exports=e},654:e=>{e.exports=t}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return r[e](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{o.d(i,{default:()=>Ge});var e={};o.r(e),o.d(e,{ChoiceField:()=>Je,DataView:()=>be,Form:()=>We,FormContext:()=>He,FormContextProvider:()=>je,MultiChoiceField:()=>Ue,TextField:()=>Ke,ToggleField:()=>_e,ViewStateProvider:()=>pe,classNames:()=>Ce,combineRef:()=>ke,combineValidators:()=>Le,createBreakpointContext:()=>fe,innerTextOrHTML:()=>we,partial:()=>Oe,registerFieldType:()=>qe,toRefCallback:()=>Ee,useAsync:()=>oe,useDataView:()=>Se,useDispose:()=>ue,useErrorHandler:()=>se,useErrorHandlerRef:()=>ae,useFormContext:()=>Te,useFormField:()=>De,useMediaQuery:()=>ce,useMemoizedFunction:()=>re,useObservableProperty:()=>ne,useRefInitCallback:()=>ie,useUpdateTrigger:()=>te,useViewState:()=>ve,withSuspense:()=>Pe});var t=o(359),r=o(654),n=r.util,u=n.noop,a=n.pipe,s=n.either,c=n.is,f=n.isUndefinedOrNull,l=n.isArray,d=n.isFunction,p=(n.isThenable,n.isPlainObject),v=(n.isArrayLike,n.makeArray),m=n.extend,h=n.each,g=n.map,y=n.grep,b=n.splice,S=n.any,C=n.single,w=n.kv,O=(n.fill,n.pick),k=n.exclude,E=(n.mapObject,n.mapGet),P=n.mapRemove,x=(n.arrRemove,n.setAdd),V=(n.equal,n.combineFn),R=(n.executeOnce,n.createPrivateStore),F=(n.setTimeout,n.setTimeoutOnce,n.setInterval,n.setIntervalSafe,n.setImmediate,n.setImmediateOnce),M=(n.throws,n.throwNotFunction,n.errorWithCode,n.isErrorWithCode),z=n.keys,I=(n.values,n.hasOwnProperty,n.getOwnPropertyDescriptors,n.define),j=n.definePrototype,N=(n.defineOwnProperty,n.defineGetterProperty,n.defineHiddenProperty,n.defineAliasProperty,n.defineObservableProperty),A=n.watch,H=(n.watchOnce,n.watchable,n.inherit,n.freeze,n.deepFreeze,n.iequal,n.randomId),T=(n.repeat,n.camel,n.hyphenate,n.ucfirst,n.lcfirst,n.trim,n.matchWord,n.htmlDecode,n.resolve),D=n.reject,L=n.always,q=n.resolveAll,W=(n.retryable,n.deferrable,n.catchAsync,n.setPromiseTimeout,n.delay,n.makeAsync),B=r.util,K=(B.domReady,B.tagName,B.isVisible,B.matchSelector,B.comparePosition,B.connected,B.containsOrEquals,B.acceptNode,B.combineNodeFilters,B.iterateNode,B.iterateNodeToArray,B.getCommonAncestor,B.parentsAndSelf,B.selectIncludeSelf,B.selectClosestRelative,B.createNodeIterator,B.createTreeWalker,B.bind);B.bindUntil,B.dispatchDOMMouseEvent,B.removeNode,B.getClass,B.setClass,B.getScrollOffset,B.getScrollParent,B.getContentRect,B.scrollBy,B.scrollIntoView,B.makeSelection,B.getRect,B.getRects,B.toPlainRect,B.rectEquals,B.rectCovers,B.rectIntersects,B.pointInRect,B.mergeRect,B.elementFromPoint;const J=r.dom;var U=r.dom,_=(U.textInputAllowed,U.beginDrag,U.beginPinchZoom,U.getShortcut,U.setShortcut,U.focusable,U.focused,U.setModal,U.releaseModal,U.retainFocus,U.releaseFocus,U.iterateFocusPath,U.focus);const G=J;var Q=r.dom,Z=(Q.lock,Q.locked,Q.cancelLock,Q.subscribeAsync,Q.notifyAsync),X=Q.preventLeave,Y=r.EventContainer,$=new WeakMap,ee=new Y;function te(){var e=(0,t.useState)()[1];return(0,t.useCallback)((function(){e({})}),[])}function re(e){var r=(0,t.useCallback)((function e(){var t=$.get(e);return t&&t.apply(this,arguments)}),[]);return $.set(r,e),r}function ne(e,r){var n=te(),o=e[r],i=(0,t.useRef)();return i.current=o,(0,t.useEffect)((function(){var t=function(e){e!==i.current&&n()};return t(e[r]),A(e,r,t)}),[e,r]),o}function oe(e,r){var n=(0,t.useState)((function(){var t,r;return{loading:!1,value:void 0,error:void 0,elementRef:function(e){t=e},on:function(e,t){return ee.add(n,e,t)},onError:function(e){return n.on("error",(function(t){return e.call(n,t.error)}))},refresh:function(){m(n,{loading:!0,error:void 0});var o=W(e)(),i=L(o,(function(e,t){if(!n.disposed&&r===i)if(e)m(n,{loading:!1,value:t}),ee.emit("load",n,{data:t});else if(m(n,{loading:!1,value:void 0,error:t}),!ee.emit("error",n,{error:t}))throw t}));return r=i,Z(t||G.root,i),o}}}))[0];return r=[!1!==r].concat(l(r)||[]),e=re(e),(0,t.useEffect)((function(){return n.disposed=!1,function(){n.disposed=!0}}),[n]),(0,t.useEffect)((function(){r[0]&&n.refresh()}),r),(0,t.useMemo)((function(){r[0]&&(n.loading=!0)}),r),ne(n,"loading"),[n.value,n]}function ie(e){var r=v(arguments),n=(0,t.useState)(new WeakSet)[0];return function(t){t&&x(n,t)&&(r[0]=t,e.apply(null,r))}}function ue(){var e=(0,t.useState)((function(){var e=[function(){e.splice(0,e.length-1)}];return m(V(e),{push:e.splice.bind(e,-1,0)})}))[0];return(0,t.useEffect)((function(){return e}),[e]),e}function ae(){return se.apply(this,arguments).ref}function se(){var e=(0,t.useRef)(!1),r=(0,t.useRef)(null),n=v(arguments),o=(0,t.useState)((function(){return{ref:function(e){r.current=e,s(e)},catch:function(e,t){var r;return t?r=d(e)?c:M:t=e,ee.add(o,r?"error":"default",(function(n){if((r||a)(n.error,e))return t(n.error)}))}}}))[0],i=(0,t.useCallback)((function(t){try{return e.current=!0,G.emit("error",r.current||G.root,{error:t},!0)}finally{e.current=!1}}),[]),u=(0,t.useCallback)((function(e){return ee.emit("error",o,{error:e})||ee.emit("default",o,{error:e})}),[]),s=ie((function(t){G.on(t,"error",(function(t){if(!e.current)return u(t.error)}))}));return(0,t.useEffect)((function(){return V(g(n,(function(e){return e.onError((function(e){return u(e)||i(e)||T()}))})))}),n),o}function ce(e){var r=ue(),n=(0,t.useState)((function(){var t=matchMedia(e);return r.push(K(t,"change",(function(){n[1](t.matches)}))),t.matches}));return n[0]}function fe(e){var r={};return A(r,!0),h(e,(function(e,t){var n=matchMedia(t),o=N(r,e,n.matches,!0);K(n,"change",(function(){o(n.matches)}))})),{breakpoints:Object.freeze(r),useBreakpoint:function(){var e=te();return(0,t.useEffect)((function(){return A(r,e)}),[]),r}}}var le=(0,t.createContext)(null),de=Object.freeze({get:u,set:u}),pe=le.Provider;function ve(e){var r=(0,t.useState)(H)[0],n=(0,t.useContext)(le),o=n&&e&&n.getState(r,e)||de;return(0,t.useEffect)((function(){return o.dispose&&o.dispose.bind(o)}),[o]),o}var me=R(),he=be.prototype,ge=new Y;function ye(e,t){var r=f(e)&&-1,n=f(t)&&1;return r||n?r+n:"string"==typeof e||"string"==typeof t?String(e).localeCompare(t,void 0,{caseFirst:"upper"}):e-t}function be(e,t,r,n){var o=this,i={filters:m({},e),sortBy:t,sortOrder:r||t&&"asc",pageIndex:0,pageSize:void 0===n?be.pageSize:n};for(var u in e=m({},e))N(e,u);var a=me(o,{filters:Object.freeze(e),defaults:i,items:[]}),s=function(){a.sorted=a.items.length?void 0:[],this!==o&&(a.filtered=a.sorted),ge.emitAsync("viewChange",o)};m(this,i),A(o,s),A(o.filters,s)}function Se(e,r,n,o,i){if("string"!=typeof e)return Se("__dataView",e,r,n,o);var a=ve(e),s=te(),c=(0,t.useState)((function(){return m(new be(r,n,o,i),a.get())}))[0];return(0,t.useEffect)((function(){var e=me(c);return V(c.on("viewChange",s),a.onPopState?a.onPopState((function(t){a.set(c.toJSON()),m(c,t||e.defaults)})):u,(function(){a.set(c.toJSON())}))}),[c]),c}function Ce(){var e=[];return function t(r){h(r,(function(r,n){if(n)if("string"==typeof n)e.push(n);else if("function"==typeof n.getClassNames)t(v(n.getClassNames()));else for(var o in n){var i=n[o];i&&e.push(!0===i?o:o+"-"+i)}}))}(v(arguments)),e.join(" ")}function we(e){return p(e)?{dangerouslySetInnerHTML:e}:{children:e}}function Oe(e,t){var r=function(t,r){e((function(e){return"string"==typeof t&&(t=w(t,d(r)?r(e[t],e):r)),m({},e,t)}))};return t?r.bind(0,t):r}function ke(){return V(v(arguments).map(Ee))}function Ee(e){return e&&!d(e)?function(t){return e.current=t}:e||u}function Pe(e,r){r=r||t.Fragment,d(r)&&(r=(0,t.createElement)(r));var n=(0,t.lazy)(e);return function(e){return(0,t.createElement)(t.Suspense,{fallback:r},(0,t.createElement)(n,e))}}function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}I(be,{pageSize:0}),j(be,{itemCount:0,on:function(e,t){return ge.add(this,e,t)},getView:function(e,t){var r=this,n=me(r),o=r.pageIndex||0,i=r.pageSize||0;e!==n.items&&(n.items=e||[],n.filtered=n.items.length?void 0:[],n.sorted=n.filtered),t=t||function(e){return r.sort(e)};var u=n.sorted||(n.sorted=t.call(r,n.filtered||n.items,r.filters,r.sortBy,r.sortOrder)||[]);return n.filtered=u,e&&(r.itemCount=u.length),[u.slice(o*i,i?(o+1)*i:void 0),u.length]},sort:function(e,t){if(e=v(e),!d(t)){var r=t||this.sortBy;if(!r)return e;t=function(e){return e[r]}}var n="desc"===this.sortOrder?-1:1,o=new Map;return h(e,(function(e,r){o.set(r,t(r))})),e.sort((function(e,t){var r=o.get(e),i=o.get(t);return n*(l(r)?C(r,(function(e,t){return ye(e,i[t])})):ye(r,i))}))},toJSON:function(){var e=this;return m(O(e,z(me(e).defaults)),{filters:m({},e.filters),itemCount:e.itemCount})},reset:function(){m(this,me(this).defaults)}}),N(he,"sortBy"),N(he,"sortOrder"),N(he,"pageIndex"),N(he,"pageSize"),N(he,"filters",{},(function(e){return m(me(this).filters,e)}));var Ve=R(),Re=new Y,Fe=new WeakMap,Me=new Map,ze={text:Ke,toggle:_e,choice:Je},Ie=(0,t.createContext)(null),je=Ie.Provider;function Ne(e){return f(e)||""===e||l(e)&&!e.length}function Ae(){h(Me,(function(e){Re.emit("dataChange",e,Object.keys(P(Me,e)))}))}function He(e,t,r){var n=this,o={},i=Ve(n,{fields:o,viewState:r,vlocks:{},initialData:e,setValid:N(this,"isValid",!0,(function(){return!S(o,(function(e,t){var r=e.props;return!r.disabled&&(e.error||r.required&&(r.isEmpty||e.preset.isEmpty||Ne)(e.value))}))}))});m(n,function(e){return"boolean"==typeof e&&(e={validateOnChange:e}),m({autoPersist:!0,preventLeave:!1,validateOnChange:!0},e)}(t)),n.ref=function(e){i.ref=e},n.isValid=!0,n.data=function(e,t){var r=Ve(e),n=m({},t),o=function(t){E(Me,e,Object)[t]=!0,F(Ae)},i=new Proxy(n,{set:function(e,t,n){if("string"==typeof t&&(e[t]!==n||!(t in e))){var i=r.fields[t];o(t),e[t]=n,i&&(i.value=n,(i.props.onChange||u)(n))}return!0},deleteProperty:function(e,t){return t in e&&(o(t),delete e[t]),!0}});return Ve(i,n),i}(n,r.get()||i.initialData),n.on("dataChange",(function(e){if(n.validateOnChange){var t=y(e.data,(function(e){return o[e]&&!1!==o[e].props.validateOnChange}));t[0]&&n.validate.apply(n,t)}if(n.preventLeave&&!i.unlock){var r=new Promise((function(e){i.unlock=function(){i.unlock=null,e()}}));X(i.ref||G.root,r,(function(){return Re.emit("beforeLeave",n)||D()}))}}))}function Te(e,r,n){if("string"!=typeof e)return Te("",e,r);var o=ve(e),i=(0,t.useState)((function(){return new He(r,n,o)}))[0],a=te();return ne(i,"isValid"),(0,t.useEffect)((function(){return V(i.on("dataChange",a),i.on("reset",a),(function(){(Ve(i).unlock||u)(),i.autoPersist&&i.persist()}))}),[i]),i}function De(e,r,n,o){"string"==typeof e&&(e=ze[e]),d(e)||(o=n,n=r,r=e,e="");var i=e?E(Fe,e,e):{};o=o||i.valueProperty||"value";var s=(0,t.useContext)(Ie),c=s&&s.data,f=s&&Ve(s),l=r.name||"",p=o in r,v=(0,t.useState)((function(){var e=p?r[o]:s&&l in c?c[l]:n,t={initialValue:e,value:e,error:"",setValue:function(e){e=d(e)?e(t.value):e,t.controlled?(t.props.onChange||u)(e):t.value=e},setError:function(e){t.error=d(e)?e(t.error):e},elementRef:function(e){t.element=e}};return A(t,!0),N(t,"error","",(function(e){return d(e)?function(e,t){return{toString:function(){return t(e.props||{})}}}(t,e):e||""})),A(t,"value",(function(e){(t.dict||{})[t.name]=e})),A(t,"error",(function(e){t.dict&&t.name&&Re.emit("validationChange",t.form,{name:t.name,isValid:!e,message:String(e)})})),t}))[0],h="error"in r,g=v.name||l;m(v,{form:s,preset:i,props:r,controlled:p,dict:c,name:l}),p&&(v.value=r[o]),h&&(v.error=r.error),s&&l&&(f.fields[l]=v,h||l===g||(v.error=""),l in c?p||l===g||(v.value=c[l]):(Ve(c)[l]=v.initialValue,v.value=c[l]));var y=(i.postHook||a)({form:s,value:v.value,error:String(v.error),setValue:v.setValue,setError:v.setError,elementRef:v.elementRef},r);return(0,t.useEffect)((function(){return function(){f&&f.fields[l]===v&&(delete f.fields[l],v.props.clearWhenUnmount&&delete Ve(v.dict)[l],f.setValid())}}),[f,l]),(0,t.useEffect)((function(){f&&f.setValid()}),[f,v.error,r.disabled,r.required]),y.value=ne(v,"value"),y.error=String(ne(v,"error")),y}function Le(){var e=y(v(arguments),d);return function(t,r){return e.reduce((function(e,n){return e.then((function(e){return e||n(t,r)}))}),T())}}function qe(e,t){d(t)&&(t={postHook:t}),ze[e]=function(){return t}}j(He,{element:function(e){var t=Ve(this).fields[e];return t&&t.element},focus:function(e){var t=this.element(e);t&&_(t)},on:function(e,t){return Re.add(this,e,t)},persist:function(){var e=this;Ve(e).viewState.set(e.toJSON()),e.autoPersist=!1},restore:function(){var e=Ve(this).viewState.get();return e&&this.reset(e),!!e},reset:function(e){var t=this,r=Ve(t),n=Ve(t.data);for(var o in n)delete n[o];m(n,e||r.initialData),h(r.fields,(function(e,t){e in n?t.value=n[e]:t.controlled&&(n[e]=t.initialValue,t.value=t.initialValue,(t.props.onChange||u)(t.value)),t.error=null})),r.setValid(),(r.unlock||u)(),Re.emit("reset",t)},getError:function(e){return String((Ve(this).fields[e]||"").error||"")},setError:function(e,t){(Ve(this).fields[e]||{}).error=t},validate:function(){var e=this,t=Ve(e),r=t.vlocks,n=v(arguments);n.length||(n=z(t.fields));var o=function(r){var n=t.fields[r],o=e.data[r],i=Re.emit("validate",e,{name:r,value:o});return!i&&n&&(i=(n.props.onValidate||u)(o,r,e)),i},i=n.map((function(e){var t=r[e]=r[e]||[],n=t[0];return n?t[1]||(t[1]=L(t[0],(function(){var r=o(e);return L(r,(function(){t[0]===n&&t.shift()})),r}))):(t[0]=T(o(e)),t[0])}));return q(i).then((function(o){return n.forEach((function(t,n){r[t][0]===i[n]&&(r[t].shift(),e.setError(t,o[n]))})),t.setValid(),!S(o,(function(e){return e}))}))},toJSON:function(){return m(!0,{},this.data)}});var We=(0,t.forwardRef)((function(e,r){var n=e.context;return m(n,O(e,["enterKeyHint","preventLeave"])),(0,t.createElement)(je,{value:n},(0,t.createElement)("form",m(k(e,["context","enterKeyHint","preventLeave"]),{ref:ke(r,n.ref),onSubmit:function(t){e.action||t.preventDefault(),(e.onSubmit||u).call(this,t)},onReset:function(t){t.preventDefault(),n.reset(),(e.onReset||u).call(this,t)}})))}));function Be(e){return(0,t.useMemo)((function(){return(e||[]).map((function(e){return"object"===xe(e)?e:{label:String(e),value:e}}))}),[e])}function Ke(){this.postHook=function(e,t){var r=e.form,n=O(t,["type","autoComplete","maxLength","inputMode","placeholder","enterKeyHint"]);return"password"!==t.type||n.autoComplete||(n.autoComplete="current-password"),n.type=n.type||"text",n.enterKeyHint=n.enterKeyHint||r&&r.enterKeyHint,m(e,{inputProps:n})}}function Je(){this.postHook=function(e,r){var n=Be(r.items),o=n.findIndex((function(t){return t.value===e.value}));return(0,t.useEffect)((function(){o<0&&(o=r.allowUnselect||!n[0]?-1:0,e.setValue(o<0?"":n[0].value))})),m(e,{items:n,selectedIndex:o,selectedItem:n[o]})}}function Ue(){this.postHook=function(e,r){var n=r.allowCustomValues||!r.items,o=Be(r.items),i=function(e){return!o.some((function(t){return t.value===e}))},u=re((function(t,r){!n&&i(t)||e.setValue((function(e){var n=e.indexOf(t);return(f(r)||s(n<0,r))&&(e=v(e),n<0?e.push(t):e.splice(n,1)),e}))}));return(0,t.useEffect)((function(){if(!n){var t=v(e.value);b(t,i).length&&e.setValue(t)}})),m(e,{items:o,toggleValue:u})}}function _e(){this.valueProperty="checked",this.isEmpty=function(e){return!e}}const Ge=e;r.react=e})(),i=i.default})()}));
//# sourceMappingURL=zeta-dom-react.min.js.map
